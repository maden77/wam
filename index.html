<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Ferrari Racing Siang Hari</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; touch-action: none; font-family: Arial, sans-serif; }
        
        /* UI Skor */
        #ui-layer { 
            position: absolute; top: 20px; left: 20px; color: white; 
            font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); 
            pointer-events: none; z-index: 10;
        }

        /* Layar Start */
        #start-screen {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8); 
            z-index: 2000; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; color: white; text-align: center;
        }
        #start-button {
            padding: 15px 40px; font-size: 20px; background: #ffcc00; 
            border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px;
        }

        /* Kontrol Android */
        #controls { 
            position: absolute; bottom: 30px; width: 100%; 
            display: flex; justify-content: space-around; align-items: center; 
            padding: 0 10px; box-sizing: border-box; z-index: 1000;
        }
        .btn { 
            width: 75px; height: 75px; background: rgba(255, 255, 255, 0.4); 
            border: 3px solid white; border-radius: 50%; color: white; 
            font-size: 28px; display: flex; justify-content: center; 
            align-items: center; user-select: none; -webkit-user-select: none;
        }
        .btn:active { background: rgba(255, 255, 255, 0.8); color: black; }
        .column { display: flex; flex-direction: column; gap: 15px; }
    </style>
</head>
<body>

    <div id="ui-layer">SKOR: 0</div>

    <div id="start-screen">
        <h1>FERRARI DAY CHALLENGE</h1>
        <p>Gunakan tombol di layar untuk menyetir</p>
        <button id="start-button">MULAI BALAPAN</button>
    </div>

    <div id="controls">
        <div id="btnLeft" class="btn">◀</div>
        <div class="column">
            <div id="btnUp" class="btn">▲</div>
            <div id="btnDown" class="btn">▼</div>
        </div>
        <div id="btnRight" class="btn">▶</div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- 1. SETUP DUNIA (SIANG HARI) ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Langit Biru
        scene.fog = new THREE.Fog(0x87CEEB, 50, 400);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        document.body.appendChild(renderer.domElement);

        // Pencahayaan Siang
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);

        const sunLight = new THREE.DirectionalLight(0xffffff, 1.2);
        sunLight.position.set(50, 100, 50);
        scene.add(sunLight);

        // --- 2. MODEL FERRARI KUNING ---
        const car = new THREE.Group();
        const yellowMat = new THREE.MeshStandardMaterial({ color: 0xffcc00, metalness: 0.6, roughness: 0.2 });
        const blackMat = new THREE.MeshStandardMaterial({ color: 0x111111 });
        const glassMat = new THREE.MeshStandardMaterial({ color: 0x88ccff, transparent: true, opacity: 0.5 });

        // Body Utama
        const bodyBase = new THREE.Mesh(new THREE.BoxGeometry(1.7, 0.6, 4), yellowMat);
        bodyBase.position.y = 0.5;
        car.add(bodyBase);

        // Kabin
        const cabin = new THREE.Mesh(new THREE.BoxGeometry(1.3, 0.6, 1.8), glassMat);
        cabin.position.set(0, 1.0, -0.2);
        car.add(cabin);

        // Ban (4 buah)
        const wheelGeo = new THREE.CylinderGeometry(0.4, 0.4, 0.4, 16);
        const wheelPositions = [[-0.9, 0.4, 1.3], [0.9, 0.4, 1.3], [-0.9, 0.4, -1.3], [0.9, 0.4, -1.3]];
        wheelPositions.forEach(pos => {
            const w = new THREE.Mesh(wheelGeo, blackMat);
            w.rotation.z = Math.PI/2;
            w.position.set(...pos);
            car.add(w);
        });
        scene.add(car);

        // --- 3. LINGKUNGAN (JALAN & RUMPUT) ---
        const trackGeo = new THREE.PlaneGeometry(20, 10000);
        const trackMat = new THREE.MeshStandardMaterial({ color: 0x333333 });
        const track = new THREE.Mesh(trackGeo, trackMat);
        track.rotation.x = -Math.PI / 2;
        scene.add(track);

        const grassGeo = new THREE.PlaneGeometry(500, 10000);
        const grassMat = new THREE.MeshStandardMaterial({ color: 0x2d5a27 });
        const grass = new THREE.Mesh(grassGeo, grassMat);
        grass.rotation.x = -Math.PI / 2;
        grass.position.y = -0.02; // Sedikit di bawah aspal
        scene.add(grass);

        // Rintangan
        const obstacles = [];
        for(let i=1; i<60; i++) {
            const obs = new THREE.Mesh(new THREE.BoxGeometry(3, 2, 3), new THREE.MeshStandardMaterial({color: 0xff4400}));
            obs.position.set(Math.random() * 14 - 7, 1, -i * 70);
            scene.add(obs);
            obstacles.push(obs);
        }

        // --- 4. AUDIO & KONTROL ---
        let speed = 0, score = 0, gameActive = false;
        let audioCtx, osc, gainNode;
        const touch = { Up: false, Down: false, Left: false, Right: false };

        function initAudio() {
            if (audioCtx) return;
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            osc = audioCtx.createOscillator();
            gainNode = audioCtx.createGain();
            osc.type = 'sawtooth';
            gainNode.gain.setValueAtTime(0.01, audioCtx.currentTime);
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            osc.start();
        }

        // Event Start
        document.getElementById('start-button').addEventListener('click', () => {
            document.getElementById('start-screen').style.display = 'none';
            gameActive = true;
            initAudio();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        });

        // Kontrol Tombol
        const bindBtn = (id, key) => {
            const el = document.getElementById(id);
            el.addEventListener('touchstart', (e) => { e.preventDefault(); touch[key] = true; });
            el.addEventListener('touchend', (e) => { e.preventDefault(); touch[key] = false; });
        };
        bindBtn('btnUp', 'Up'); bindBtn('btnDown', 'Down'); bindBtn('btnLeft', 'Left'); bindBtn('btnRight', 'Right');

        // --- 5. GAME LOOP ---
        function animate() {
            requestAnimationFrame(animate);
            if (!gameActive) return;

            // Logika Gerak
            if (touch.Up) speed += 0.02;
            if (touch.Down) speed -= 0.02;
            speed *= 0.96; // Friction
            car.translateZ(-speed);

            if (Math.abs(speed) > 0.01) {
                if (touch.Left) car.rotation.y += 0.05;
                if (touch.Right) car.rotation.y -= 0.05;
            }

            // Update Audio
            if (osc) {
                const pitch = 60 + (Math.abs(speed) * 200);
                osc.frequency.setTargetAtTime(pitch, audioCtx.currentTime, 0.1);
                gainNode.gain.setTargetAtTime(speed > 0.01 ? 0.06 : 0.02, audioCtx.currentTime, 0.1);
            }

            // Tabrakan & Skor
            score = Math.floor(Math.abs(car.position.z));
            document.getElementById('ui-layer').innerHTML = `SKOR: ${score}`;

            const carBox = new THREE.Box3().setFromObject(car);
            obstacles.forEach(obs => {
                if(carBox.intersectsBox(new THREE.Box3().setFromObject(obs))) {
                    speed = -0.15; // Mental saat tabrak
                }
            });

            // Kamera Follow
            const camPos = new THREE.Vector3(0, 3, 8).applyMatrix4(car.matrixWorld);
            camera.position.lerp(camPos, 0.1);
            camera.lookAt(car.position);

            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>
</body>
</html>
